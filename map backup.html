<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>World Pin Board - Collect Your Travels</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: white;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }

        .header p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
        }

        .map-container {
            flex: 1;
            position: relative;
            margin: 20px;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        #map {
            height: 100%;
            min-height: 600px;
        }

        .stats-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            min-width: 200px;
        }

        .stats-panel h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-value {
            font-weight: bold;
            color: #d4af37;
            font-size: 1.2rem;
        }

        .country-magnet-overlay {
            cursor: pointer;
            transition: all 0.4s ease;
        }

        .magnet-animate {
            animation: magnetOverlayDrop 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.5)) 
                    drop-shadow(0 4px 8px rgba(212, 175, 55, 0.3)) !important;
        }

        .magnet-animate:hover {
            filter: drop-shadow(0 12px 24px rgba(0, 0, 0, 0.6)) 
                    drop-shadow(0 6px 12px rgba(212, 175, 55, 0.4)) 
                    brightness(1.1) !important;
            transform: scale(1.02);
        }

        @keyframes magnetOverlayDrop {
            0% {
                opacity: 0;
                transform: translateY(-50px) scale(0.8);
                filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.8)) 
                        drop-shadow(0 10px 20px rgba(212, 175, 55, 0.5));
            }
            50% {
                opacity: 0.7;
                transform: translateY(5px) scale(1.05);
                filter: drop-shadow(0 15px 30px rgba(0, 0, 0, 0.7)) 
                        drop-shadow(0 7px 15px rgba(212, 175, 55, 0.4));
            }
            80% {
                opacity: 0.9;
                transform: translateY(-2px) scale(0.98);
                filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.6)) 
                        drop-shadow(0 5px 10px rgba(212, 175, 55, 0.35));
            }
            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
                filter: drop-shadow(0 8px 16px rgba(0, 0, 0, 0.5)) 
                        drop-shadow(0 4px 8px rgba(212, 175, 55, 0.3));
            }
        }

        /* Enhanced 3D effect with gradient overlay */
        .country-magnet-overlay path {
            fill: url(#countryGradient) !important;
        }

        /* Create metallic gradient effect */
        svg defs {
            display: none;
        }

        .country-hover {
            fill-opacity: 0.7 !important;
            stroke: #ffd700 !important;
            stroke-width: 2 !important;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }

        .country-visited {
            fill: #d4af37 !important;
            fill-opacity: 0.3 !important;
            stroke: #b8860b !important;
            stroke-width: 2 !important;
        }

        .reset-button {
            position: absolute;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(145deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 50px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(238, 90, 82, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .reset-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 25px rgba(238, 90, 82, 0.4);
        }

        .instruction {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 20px;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            z-index: 1000;
            color: #333;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .stats-panel {
                position: relative;
                top: 0;
                right: 0;
                margin: 20px;
                margin-bottom: 0;
            }
            
            .map-container {
                margin-top: 0;
            }
            
            .instruction,
            .reset-button {
                position: relative;
                margin: 10px 20px;
                bottom: auto;
                left: auto;
                right: auto;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üåç World Pin Board</h1>
        <p>Click on countries to mark them as visited and collect golden pins!</p>
    </div>

    <div class="map-container">
        <div id="map"></div>
        
        <div class="stats-panel">
            <h3>üìä Your Journey</h3>
            <div class="stat-item">
                <span>Countries Visited:</span>
                <span class="stat-value" id="visitedCount">0</span>
            </div>
            <div class="stat-item">
                <span>Total Countries:</span>
                <span class="stat-value" id="totalCount">195</span>
            </div>
            <div class="stat-item">
                <span>Progress:</span>
                <span class="stat-value" id="progressPercent">0%</span>
            </div>
        </div>
        
        <div class="instruction">
            üí° Click any country to collect a country-shaped magnet!
        </div>
        
        <button class="reset-button" onclick="resetAllPins()">
            üîÑ Reset All Pins
        </button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <script>
let map;
let visitedCountries = new Set();
let countryLayers = {};
let pins = {};

// Mapping: country name from GeoJSON ‚Üí ISO 3166-1 alpha-2 code (lowercase)
const countryCodeMap = {
    "Afghanistan":"af","Albania":"al","Algeria":"dz","Andorra":"ad","Angola":"ao","Antigua and Barbuda":"ag",
    "Argentina":"ar","Armenia":"am","Australia":"au","Austria":"at","Azerbaijan":"az","Bahamas":"bs",
    "Bahrain":"bh","Bangladesh":"bd","Barbados":"bb","Belarus":"by","Belgium":"be","Belize":"bz","Benin":"bj",
    "Bhutan":"bt","Bolivia":"bo","Bosnia and Herzegovina":"ba","Botswana":"bw","Brazil":"br","Brunei":"bn",
    "Bulgaria":"bg","Burkina Faso":"bf","Burundi":"bi","Cabo Verde":"cv","Cambodia":"kh","Cameroon":"cm",
    "Canada":"ca","Central African Republic":"cf","Chad":"td","Chile":"cl","China":"cn","Colombia":"co",
    "Comoros":"km","Congo (Brazzaville)":"cg","Congo (Kinshasa)":"cd","Costa Rica":"cr","Croatia":"hr",
    "Cuba":"cu","Cyprus":"cy","Czech Republic":"cz","Denmark":"dk","Djibouti":"dj","Dominica":"dm",
    "Dominican Republic":"do","Ecuador":"ec","Egypt":"eg","El Salvador":"sv","Equatorial Guinea":"gq",
    "Eritrea":"er","Estonia":"ee","Eswatini":"sz","Ethiopia":"et","Fiji":"fj","Finland":"fi","France":"fr",
    "Gabon":"ga","Gambia":"gm","Georgia":"ge","Germany":"de","Ghana":"gh","Greece":"gr","Grenada":"gd",
    "Guatemala":"gt","Guinea":"gn","Guinea-Bissau":"gw","Guyana":"gy","Haiti":"ht","Honduras":"hn",
    "Hungary":"hu","Iceland":"is","India":"in","Indonesia":"id","Iran":"ir","Iraq":"iq","Ireland":"ie",
    "Israel":"il","Italy":"it","Jamaica":"jm","Japan":"jp","Jordan":"jo","Kazakhstan":"kz","Kenya":"ke",
    "Kiribati":"ki","Kuwait":"kw","Kyrgyzstan":"kg","Laos":"la","Latvia":"lv","Lebanon":"lb","Lesotho":"ls",
    "Liberia":"lr","Libya":"ly","Liechtenstein":"li","Lithuania":"lt","Luxembourg":"lu","Madagascar":"mg",
    "Malawi":"mw","Malaysia":"my","Maldives":"mv","Mali":"ml","Malta":"mt","Marshall Islands":"mh",
    "Mauritania":"mr","Mauritius":"mu","Mexico":"mx","Micronesia":"fm","Moldova":"md","Monaco":"mc",
    "Mongolia":"mn","Montenegro":"me","Morocco":"ma","Mozambique":"mz","Myanmar":"mm","Namibia":"na",
    "Nauru":"nr","Nepal":"np","Netherlands":"nl","New Zealand":"nz","Nicaragua":"ni","Niger":"ne",
    "Nigeria":"ng","North Korea":"kp","North Macedonia":"mk","Norway":"no","Oman":"om","Pakistan":"pk",
    "Palau":"pw","Palestine":"ps","Panama":"pa","Papua New Guinea":"pg","Paraguay":"py","Peru":"pe",
    "Philippines":"ph","Poland":"pl","Portugal":"pt","Qatar":"qa","Romania":"ro","Russia":"ru","Rwanda":"rw",
    "Saint Kitts and Nevis":"kn","Saint Lucia":"lc","Saint Vincent and the Grenadines":"vc","Samoa":"ws",
    "San Marino":"sm","Sao Tome and Principe":"st","Saudi Arabia":"sa","Senegal":"sn","Serbia":"rs",
    "Seychelles":"sc","Sierra Leone":"sl","Singapore":"sg","Slovakia":"sk","Slovenia":"si","Solomon Islands":"sb",
    "Somalia":"so","South Africa":"za","South Korea":"kr","South Sudan":"ss","Spain":"es","Sri Lanka":"lk",
    "Sudan":"sd","Suriname":"sr","Sweden":"se","Switzerland":"ch","Syria":"sy","Tajikistan":"tj","Tanzania":"tz",
    "Thailand":"th","Timor-Leste":"tl","Togo":"tg","Tonga":"to","Trinidad and Tobago":"tt","Tunisia":"tn",
    "Turkey":"tr","Turkmenistan":"tm","Tuvalu":"tv","Uganda":"ug","Ukraine":"ua","United Arab Emirates":"ae",
    "United Kingdom":"gb","United States of America":"us","Uruguay":"uy","Uzbekistan":"uz","Vanuatu":"vu",
    "Vatican":"va","Venezuela":"ve","Vietnam":"vn","Yemen":"ye","Zambia":"zm","Zimbabwe":"zw"
};

// Initialize map
function initMap() {
    map = L.map('map', {
        center: [20, 0],
        zoom: 2,
        maxZoom: 6,
        minZoom: 1.5,
        worldCopyJump: true
    });

    L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap contributors ¬© CARTO',
        subdomains: 'abcd',
        maxZoom: 19
    }).addTo(map);

    loadCountries();
}

async function loadCountries() {
    const response = await fetch('https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson');
    const countries = await response.json();

    // Add SVG defs for patterns
    const mapContainer = document.getElementById('map');
    const svgDefs = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
    svgDefs.style.position = 'absolute';
    svgDefs.style.width = '0';
    svgDefs.style.height = '0';
    svgDefs.innerHTML = `<defs></defs>`;
    mapContainer.appendChild(svgDefs);

    L.geoJSON(countries, {
        style: defaultStyle,
        onEachFeature: onEachFeature
    }).addTo(map);

    updateStats();
}

function defaultStyle() {
    return {
        fillColor: '#8FB3D3',
        weight: 1,
        opacity: 1,
        color: '#5F84A2',
        fillOpacity: 0.7
    };
}

function onEachFeature(feature, layer) {
    const countryName = feature.properties.name || feature.properties.NAME || 'Unknown';
    countryLayers[countryName] = layer;

    layer.on({
        mouseover: function(e) {
            if (!visitedCountries.has(countryName)) {
                e.target.setStyle({
                    fillColor: '#FFD700',
                    fillOpacity: 0.8,
                    weight: 2,
                    color: '#B8860B'
                });
            }
        },
        mouseout: function(e) {
            if (!visitedCountries.has(countryName)) {
                layer.setStyle(defaultStyle());
            }
        },
        click: function(e) {
            toggleCountry(countryName, layer);
        }
    });

    layer.bindTooltip(countryName, { permanent: false, direction: 'top' });
}

function toggleCountry(countryName, layer) {
    if (visitedCountries.has(countryName)) {
        visitedCountries.delete(countryName);
        layer.setStyle(defaultStyle());
        if (pins[countryName]) {
            map.removeLayer(pins[countryName]);
            delete pins[countryName];
        }
    } else {
        visitedCountries.add(countryName);
        applyFlagImage(countryName, layer);
        addPin(countryName, layer);
    }
    updateStats();
}

function applyFlagImage(countryName, layer) {
    const code = countryCodeMap[countryName];
    if (!code) {
        console.warn("No ISO code for", countryName);
        return;
    }
    const patternId = `flag-pattern-${code}`;
    let defs = document.querySelector('#map svg defs');

    if (!document.getElementById(patternId)) {
        const pattern = document.createElementNS('http://www.w3.org/2000/svg', 'pattern');
        pattern.setAttribute('id', patternId);
        pattern.setAttribute('patternUnits', 'objectBoundingBox');
        pattern.setAttribute('width', '1');
        pattern.setAttribute('height', '1');

        const image = document.createElementNS('http://www.w3.org/2000/svg', 'image');
        image.setAttribute('href', `https://flagcdn.com/w320/${code}.png`);
        image.setAttribute('preserveAspectRatio', 'xMidYMid slice');
        image.setAttribute('width', '100%');
        image.setAttribute('height', '100%');

        pattern.appendChild(image);
        defs.appendChild(pattern);
    }

    layer.setStyle({
        fillColor: `url(#${patternId})`,
        fillOpacity: 1,
        weight: 1,
        color: '#000'
    });
}

function getMainTerritoryCenter(countryName, layer) {
    return layer.getBounds().getCenter();
}

function addPin(countryName, layer) {
    const center = getMainTerritoryCenter(countryName, layer);
    const pinIcon = L.divIcon({
        className: 'country-magnet',
        html: `<div style="background:white;border-radius:50%;padding:5px;">üìç</div>`,
        iconSize: [30, 30],
        iconAnchor: [15, 15]
    });
    const pin = L.marker(center, { icon: pinIcon }).addTo(map);
    pin.bindPopup(`<b>${countryName}</b> visited!`);
    pins[countryName] = pin;
}

function updateStats() {
    document.getElementById('visitedCount').textContent = visitedCountries.size;
    document.getElementById('totalCount').textContent = Object.keys(countryLayers).length;
    document.getElementById('progressPercent').textContent =
        Object.keys(countryLayers).length > 0
            ? Math.round((visitedCountries.size / Object.keys(countryLayers).length) * 100) + '%'
            : '0%';
}

function resetAllPins() {
    visitedCountries.clear();
    Object.values(countryLayers).forEach(layer => layer.setStyle(defaultStyle()));
    Object.values(pins).forEach(pin => map.removeLayer(pin));
    pins = {};
    updateStats();
}

document.addEventListener('DOMContentLoaded', initMap);
    </script>
</body>
</html>
